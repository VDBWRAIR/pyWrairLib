#!/usr/bin/env python

#############################################################################################
##  Author: Tyghe Vallard
##  Email: vallardt@gmail.com
##  Date: 3/18/2013
##  Purpose:
##      This script is simply to link 454 demultiplexed read files into a ReadsBySample
##      directory.
##      The ReadsBySample directory path is defined inside of the config/settings.cfg file
##      Essentially it searches the given demultiplexed directory path for sff files
##      and links them into their SampleName directory inside of ReadsBySample
##  Version:
##      1.0 -
##          Initial Script
#############################################################################################

import os
import os.path
import sys
from argparse import ArgumentParser

from wrairdata.structure import *
from wrairlib.settings import config

# Grab the logger
logging.basicConfig(level=settings.LOG_LEVEL, format='%(asctime)s -- %(name)s[%(levelname)s] -- %(message)s')
logger = logging.getLogger( 'link_reads' )

def main( args ):
    link_reads_by_sample( args.inputdir, config['Paths']['READSBYSAMPLE_DIR'] )

def default_dir( ):
    # If demultiplexed in current directory, use that as default
    if 'demultiplexed' in os.listdir( '.' ):
        return os.path.join( os.getcwd(), 'demultiplexed' )
    return os.getcwd()

def getargs( ):
    parser = ArgumentParser( )

    default_ddir = default_dir()
    parser.add_argument( '-d', '--datadir', dest='inputdir', default=default_ddir, help='Directory containing read data[Default: %s]' % default_ddir )

    args = parser.parse_args()

    if not check_args( args ):
        parser.print_help()
        sys.exit( -1 )
    
    return args

def check_args( args ):
    return True

if __name__ == '__main__':
    args = getargs()
    main( args )
